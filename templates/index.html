<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Convertidor YouTube</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <h1>Convertidor YouTube</h1>

    <input type="text" id="urlInput" placeholder="Pega la URL de YouTube">
    <br>
    <button id="btnConvert">Convertir</button>

    <p id="errorMsg"></p>

    <div id="info" style="display: none;">
        <div class="text-info">
            <h2 id="titulo"></h2>
            <p><strong>Autor:</strong> <span id="author"></span></p>
            <p><strong>Duración:</strong> <span id="duracion"></span> segundos</p>

            <!-- Botones de descarga -->
            <form method="POST" action="/download_mp3">
                <input type="hidden" name="url" id="urlMp3">
                <button type="submit">Descargar MP3</button>
            </form>

            <form method="POST" action="/download_mp4">
                <input type="hidden" name="url" id="urlMp4">
                <button type="submit">Descargar MP4</button>
            </form>
        </div>

        <div class="thumbnail-container">
            <img id="thumbnail" src="" alt="Miniatura del video">
        </div>
    </div>

    <script>
        document.getElementById("btnConvert").addEventListener("click", async () => {
            const url = document.getElementById("urlInput").value.trim();
            const errorMsg = document.getElementById("errorMsg");
            const infoDiv = document.getElementById("info");

            errorMsg.textContent = "";
            infoDiv.style.display = "none";

            if (!url) {
                errorMsg.textContent = "Por favor ingresa una URL.";
                return;
            }

            try {
                const response = await fetch("/info", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ url })
                });

                const data = await response.json();

                if (data.error) {
                    errorMsg.textContent = data.error;
                    return;
                }

                document.getElementById("titulo").textContent = data.title;
                document.getElementById("author").textContent = data.author;
                document.getElementById("duracion").textContent = data.length;
                document.getElementById("thumbnail").src = data.thumbnail_url;

                document.getElementById("urlMp3").value = url;
                document.getElementById("urlMp4").value = url;

                infoDiv.style.display = "flex";
            } catch (err) {
                errorMsg.textContent = "Error al obtener información.";
                console.error(err);
            }
        });
    </script>

</body>
</html>
